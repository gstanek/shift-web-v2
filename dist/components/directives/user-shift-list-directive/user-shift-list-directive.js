angular.module("ShiftOnTapApp").directive("userShiftListDirective",["realmService","userService","shiftService","RealmWebSocket","$uibModal",function(a,b,c,d,e){return{scope:{userShiftListInfo:"=userShiftListModel"},templateUrl:"components/directives/user-shift-list-directive/user-shift-list.html",link:function(a){a.reclaim=function(a){d(a,!1)},a.markAvailable=function(c){var e=b.getLocalCoworkers();e&&0!=e.length?d(c,!0):a.openAddUsersModalAndMarkAvailable(c,!0)},a.coworkers=b.getLocalCoworkers(),a.activeUser=b.getLocalUser(),a.compareStartDateToNow=function(a){return moment().isBefore(a.start_datetime)};var d=function(a,b){console.log("in userShiftListDirective.updateShift id="+a+", bAvailable="+b);var d={available:b};c.updateShift(a,d).then(function(a){c.setLocalShift(a.data,!0)},function(a){})};a["delete"]=function(a){c.deleteShift(a).then(function(b){c.removeLocalShift(a,!0)},function(b){404==b.status&&c.removeLocalShift(a,!0)})},a.getShiftDisplayMode=function(a){return a.available?"panel-warning":"panel-default"},a.addUsersModal={instance:null,closeAction:""},a.openAddUsersModalAndMarkAvailable=function(b,c){a.addUsersModal.instance=e.open({animation:!0,template:'<add-users-modal addUsersModal="addUsersModal"></add-users-modal>',scope:a}),a.addUsersModal.instance.result.then(function(a){c&&d(b,!0)},function(a){})},a.modal={instance:null},a.errorObj={detail:"",code:0},a.openAddShiftModal=function(){a.errorObj.detail="",a.errorObj.code=0,a.modal.instance=e.open({animation:!0,template:'<shift-modal modal="modal" error-obj="errorObj"></shift-modal>',scope:a})},a.$on("SHIFT_CHANGE_EVENT",function(b,c){a.shifts=c});var f=function(){a.activeUser=b.getLocalUser(),a.shifts=c.getLocalShifts()};f()}}}]);