angular.module("myApp.shiftService",["LocalStorageModule"]).service("shiftService",["$rootScope","localStorageService","$http","realmService",function(a,b,c,d){this.getAvailableShiftsByUserID=function(a){var b=[];if(null!=user.persona)for(var c=user.persona.shifts,d=0;d<c.length;d++)1==c[d].available&&b.push(c[d]);return b},this.getShiftsByUserID=function(a){return null!=user.persona&&(f=user.persona.shifts),f},this.getAvailableShiftsByRealmID=function(a){var b=[];if(null!=user.persona)for(var c=user.persona.shifts,d=0;d<c.length;d++)1==c[d].available&&b.push(c[d]);return b},this.getShiftsByRealmID=function(a){var b=[];return null!=user.persona&&(b=user.persona.shifts),b},this.getAvailableShiftsByPersonaID=function(a){for(var b={},c=this.getLocalShifts(),d=0;d<c.length;d++)a==shift.userID+"-"+shift.realmID&&1==shift.available&&b.push(shift);return b},this.getShiftsByPersonaID=function(a){var b=this.getLocalShifts();if(!b)return e;for(var c=0;c<b.length;c++)a==b[c].userID+"-"+b[c].realmID&&e.push(b[c]);return e};var e=[],f=[];this.getShifts=function(){var a=d.getLocalRealm(),b="";return a&&(b="?realm_id="+a.id),c({method:"GET",url:"http://127.0.0.1:8000/api/v1/shift"+b,headers:{"Content-Type":"application/json"}})},this.updateShift=function(a,b){return c({method:"PATCH",url:"http://127.0.0.1:8000/api/v1/shift/"+a,headers:{"Content-Type":"application/json"},data:b})},this.storeShift=function(a){var b=d.getLocalRealm();console.log("startDate = "+JSON.stringify(a.startDate)),console.log("endDate = "+JSON.stringify(a.endDate));var e=a.startDate;e.setHours(a.startTime.getHours()),e.setMinutes(a.startTime.getMinutes()),e.setSeconds(0),e.setMilliseconds(0);var f=a.endDate;f.setHours(a.endTime.getHours()),f.setMinutes(a.endTime.getMinutes()),f.setSeconds(0),f.setMilliseconds(0),console.log("parsedStartDate = "+JSON.stringify(e)),console.log("parsedEndDate = "+JSON.stringify(f));var g={start_datetime:e,end_datetime:f,available:!1,realm:b.id,comment:a.comment};return console.log("shift = "+JSON.stringify(g)),c({method:"POST",url:"http://127.0.0.1:8000/api/v1/shift/",headers:{"Content-Type":"application/json"},data:g})},this.deleteShift=function(a){return c({method:"DELETE",url:"http://127.0.0.1:8000/api/v1/shift/"+a,headers:{"Content-Type":"application/json"}})},this.storeLocalShift=function(c){var d=this.getLocalShifts();d||(d=[]),g(d,"id",c.id),d.push(c),b.set("shifts",d),a.$broadcast("SHIFT_CHANGE_EVENT",d)},this.removeLocalShift=function(c){var d=this.getLocalShifts();d||(d=[]),g(d,"id",c),b.set("shifts",d),a.$broadcast("SHIFT_CHANGE_EVENT",d)},this.storeLocalShifts=function(a){b.set("shifts",a)},this.getLocalShifts=function(){var a=b.get("shifts");return a&&0==a.length?null:a},this.removeLocalShifts=function(){b.remove("shifts"),a.$broadcast("SHIFT_CHANGE_EVENT")};var g=function(a,b,c){for(var d=a.length;d--;)a[d]&&a[d].hasOwnProperty(b)&&arguments.length>2&&a[d][b]===c&&a.splice(d,1);return a}}]);