angular.module("myApp.addShiftDirective",[]).directive("addShiftDirective",["realmService","userService","shiftService",function(a,b,c){return{scope:{shiftInfo:"=addShiftModel"},templateUrl:"components/add-shift-directive/add-shift.html",link:function(d,e,f,g){function h(a){var b=a.date,c=a.mode;if("day"===c)for(var e=new Date(b).setHours(0,0,0,0),f=0;f<d.events.length;f++){var g=new Date(d.events[f].date).setHours(0,0,0,0);if(e===g)return d.events[f].status}return""}d.isActiveRealm=a.isActiveRealm();var i=function(){var a=b.getActiveUser();if(a){var d=c.getLocalShifts();return d?!0:!1}return!1};d.isShiftPresent=function(){return i()},d.companyName=a.getRealmName(),d.newShiftModel={id:"",dateRangeStart:"",dateRangeEnd:"",comment:""},d.createShift=function(){var b=a.getLocalRealm(),e={start_datetime:d.newShiftModel.dateRangeStart,end_datetime:d.newShiftModel.dateRangeEnd,available:!1,realm:b.id,comment:d.newShiftModel.comment};c.storeShift(e).then(function(a){console.log("Success:"+JSON.stringify(a)),c.storeLocalShift(a.data)},function(a){console.log("Failure:"+JSON.stringify(a))})},d.shiftDetails={startDate:null,startTime:null,endDate:null,endTime:null,comment:""},d.today=function(){return new Date},d.startDateToday=function(){d.shiftDetails.startDate=d.today()},d.startDateToday(),d.endDateToday=function(){d.shiftDetails.endDate=d.today()},d.endDateToday(),d.startDateClear=function(){d.shiftDetails.startDate=null},d.endDateClear=function(){d.shiftDetails.endDate=null};var j=new Date;j.setFullYear(j.getFullYear()+5),d.startDateOptions={formatYear:"yy",maxDate:j,minDate:new Date,startingDay:0},d.inlineOptions={customClass:h,minDate:new Date,showWeeks:!0},d.endDateOptions={formatYear:"yy",maxDate:j,minDate:new Date,startingDay:0},d.endMinDate=new Date,d.$watch("shiftDetails.startDate",function(a){d.endDateOptions.minDate=d.shiftDetails.startDate,d.shiftDetails.endDate<d.shiftDetails.startDate&&(d.shiftDetails.endDate=d.shiftDetails.startDate)}),d.showEndDateEntry=!1,d.startDateHeader="Date of Shift",d.toggleShowEndDate=function(){d.showEndDateEntry=!d.showEndDateEntry,d.showEndDateEntry?d.startDateHeader="Start Date of Shift":d.startDateHeader="Date of Shift"},d.open1=function(){d.popup1.opened=!0},d.open2=function(){d.popup2.opened=!0},d.format="shortDate",d.popup1={opened:!1},d.popup2={opened:!1}}}}]);