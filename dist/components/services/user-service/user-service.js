angular.module("ShiftOnTapApp").service("userService",["$rootScope","localStorageService","$http","commonService","$q","$log",function(a,b,c,d,e,f){var g=this;this.updateUser=function(a){return c({method:"PATCH",url:"http://127.0.0.1:8000/api/v1/user/"+a.id,headers:{"Content-Type":"application/json"},data:a}).then(function(a){return g.setLocalUser(a.data,!0),a.data})["catch"](function(a){return e.reject(a)})},this.createUsers=function(a){for(var b=a.users,d=moment.tz.guess(),f=0;f<b.length;f++)b[f].timezone=d;return console.log("createUsersPayload after timezone add="+JSON.stringify(a)),c({method:"POST",url:"http://127.0.0.1:8000/api/v1/user/bulk",headers:{"Content-Type":"application/json"},data:a}).then(function(a){return g.addLocalCoworkers(a.data,!0),a.data})["catch"](function(a){return e.reject(a)})},this.verifyInvitee=function(a,b){var d="http://127.0.0.1:8000/api/v1/user/invite/email/"+a+"/code/"+b;return c({method:"GET",url:d}).then(function(a){return a.data})["catch"](function(a){return e.reject(a)})},this.getBestDisplayName=function(){var a=g.getLocalUser();return a?a.preferred_name?a.preferred_name:a.first_name?a.first_name:a.email?a.email:"Guest":""},this.addLocalCoworkers=function(c,e){var f=b.get("coworkers");if(console.log("coworkersToAdd="+JSON.stringify(c)),c.sort(function(a,b){return parseFloat(a.id)-parseFloat(b.id)}),null!=f){for(var g=f.length,h=c.length,i=g-1,j=0;j<h;j++){for(;i>=0&&f[i].id>c[j].id;)i--;f[i].id==c[j].id?f.splice(i,1,c[j]):(f.splice(i+1,0,c[j]),i++)}b.set("coworkers",f),a.$broadcast("COWORKER_CHANGE_EVENT",f)}else b.set("coworkers",c),a.$broadcast("COWORKER_CHANGE_EVENT",c);e&&d.setPersonaDisplayState()},this.setLocalCoworkers=function(c,e){c.sort(function(a,b){return parseFloat(a.id)-parseFloat(b.id)}),b.set("coworkers",c),a.$broadcast("COWORKER_CHANGE_EVENT",c),e&&(f.info("Update Persona Display State persona state update"),d.setPersonaDisplayState())},this.getLocalCoworkers=function(){return b.get("coworkers")},this.getLocalTimezone=function(){return b.get("timezone")},this.removeLocalCoworkers=function(a){b.remove("coworkers"),a&&d.setPersonaDisplayState()},this.setLocalUser=function(c,e){b.set("user",c);var f={type:"UPDATE",value:c};a.$broadcast("USER_CHANGE_EVENT",f),e&&d.setPersonaDisplayState()},this.getLocalUser=function(){return b.get("user")},this.removeLocalUser=function(c){b.remove("user");var e={type:"DELETE",value:void 0};a.$broadcast("USER_CHANGE_EVENT",e),c&&d.setPersonaDisplayState()}}]);